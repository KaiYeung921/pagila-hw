name: tests
on:
  push:
    branches: ['*']
  pull_request:
    branches: ['*']

jobs:
  docker:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Build and Run Docker
        run: |
          # Use 'docker compose' instead of 'docker-compose'
          docker compose up -d --build

          # Give the database and initialization scripts time to run
          # Since you are copying large .sql files, let's give it 40 seconds
          sleep 40

          # Check container status
          docker ps -a

          # Run the test query
          # Note: your docker-compose environment says password is 'pass'
          # We use the 'postgres' database which is created by default
          docker compose exec -T pg psql -U postgres -d postgres -c "SELECT count(*) FROM actor;"
