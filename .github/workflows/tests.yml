name: tests
on:
  push:
    branches: ['*']
  pull_request:
    branches: ['*']

jobs:
  docker:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Build and Run Docker
        run: |
          # 1. Start the containers
          docker-compose up -d --build

          # 2. Hard sleep to allow the entrypoint scripts (01.sql, 02.sql) to finish.
          # Loading data.sql can take a few seconds.
          sleep 30

          # 3. Check if the database exists and count actors
          # We use -U postgres (from your docker-compose env) 
          # We try the 'postgres' database first to verify connectivity
          docker-compose exec -T pg psql -U postgres -d postgres -c "SELECT 1;"

          # 4. Verification of Pagila data
          # Note: If your .sql files create a database named 'pagila', 
          # change '-d postgres' to '-d pagila' below.
          docker-compose exec -T pg psql -U postgres -d postgres -c "SELECT count(*) FROM actor;"
